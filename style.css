:root { --primary: #2575fc; --bg: #f4f4f4; }
body { margin:0; height:100vh; display:flex; justify-content:center; align-items:center; background:#2c3e50; font-family:Arial,sans-serif; user-select:none; }

/* TABLET */
#phone {
    width: 960px; height: 640px; background: #111; border: 15px solid #000;
    border-radius: 25px; position: relative; overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

#screen {
    width: 100%; height: 100%; position: relative; background: #000;
    background-size: var(--wp-fit, cover);
    background-position: var(--wp-pos, center);
    background-repeat: no-repeat;
}

/* CAPAS (Z-INDEX) */
#screen-backdrop { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); backdrop-filter:blur(10px); z-index:5; display:none; }
#screen-backdrop.active { display:block; }

.dock {
    position:absolute; bottom:60px; left:10%; width:80%;
    background:rgba(255,255,255,0.25); backdrop-filter:blur(15px);
    border-radius:20px; padding:15px; display:flex; justify-content:center; gap:20px;
    z-index: 10; /* MENOR QUE LAS APPS */
    transition: transform 0.3s;
}
.dock.hidden { transform: translateY(150px); pointer-events: none; }

.app-window {
    position:absolute; top:30px; bottom:45px; left:0; width:100%;
    background:#f5f5f5; display:none; flex-direction:column;
    z-index: 20; /* MAYOR QUE EL DOCK */
}

#status-bar { position:absolute; top:0; width:100%; height:30px; display:flex; justify-content:space-between; padding:0 15px; color:white; font-size:12px; align-items:center; z-index:100; box-sizing:border-box; }
.nav-bar { position:absolute; bottom:0; width:100%; height:45px; background:rgba(0,0,0,0.8); display:flex; justify-content:space-around; align-items:center; z-index:100; }
.nav-button { background:none; border:none; color:white; font-size:24px; cursor:pointer; }

/* COMPONENTES */
.app-icon { display:flex; flex-direction:column; align-items:center; color:white; cursor:pointer; width:70px; }
.app-icon i { font-size:30px; background:white; color:#333; padding:10px; border-radius:50%; margin-bottom:5px; }
.app-header { background:white; padding:12px; font-weight:bold; display:flex; justify-content:space-between; }
.app-body { flex:1; padding:20px; overflow-y:auto; }

#quick-settings-panel { position:absolute; top:-100%; left:10%; width:80%; background:rgba(255,255,255,0.95); padding:20px; border-radius:0 0 20px 20px; transition:top 0.3s; z-index:200; display:flex; gap:10px; }
#quick-settings-panel.active { top:0; }
.qs-tile { background:#eee; padding:15px; border-radius:10px; text-align:center; cursor:pointer; flex:1; }
.qs-tile.active { background:var(--primary); color:white; }

/* ESTILOS INTERNOS */
.primary-btn, .danger-btn, .secondary-btn { border:none; padding:10px 20px; border-radius:5px; color:white; cursor:pointer; margin:5px; }
.primary-btn { background:var(--primary); } .danger-btn { background:#e74c3c; } .secondary-btn { background:#95a5a6; }

/* Galeria */
#gallery-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(100px, 1fr)); gap:10px; align-content: start; }
.gallery-item { height:100px; background:#ddd; cursor:pointer; overflow:hidden; border-radius:5px; }
.gallery-item img { width:100%; height:100%; object-fit:cover; }
.gallery-item.selected { border:3px solid var(--primary); }

/* ========================================== */
/* MODAL DE GALERÍA (FIX DEFINITIVO) */
/* ========================================== */
#gallery-modal { 
    position: absolute; 
    top: 0; left: 0; 
    width: 100%; height: 100%; 
    background: rgba(0, 0, 0, 0.95); 
    z-index: 300; 
    
    /* Centrado Flex */
    display: flex; 
    justify-content: center; 
    align-items: center; 
}

#gallery-modal.hidden { display: none; }

/* Contenedor interno que limita el tamaño */
.modal-content {
    /* Forzamos a que nunca supere el 90% de la altura de la pantalla */
    height: 90%; 
    width: 90%;
    
    display: flex;
    flex-direction: column; /* Elementos uno debajo del otro */
    align-items: center;
    justify-content: center;
}

#gallery-modal-image { 
    /* LA CLAVE: flex: 1 y min-height: 0 obligan a la imagen a encogerse
       si falta espacio, respetando el espacio de los botones */
    flex: 1; 
    min-height: 0; 
    
    width: auto;
    max-width: 100%; 
    object-fit: contain; /* Asegura que se vea completa sin recorte */
    margin-bottom: 15px;
    border-radius: 5px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

.modal-actions {
    /* Evita que los botones se aplasten */
    flex-shrink: 0; 
    display: flex;
    gap: 15px;
}

#gallery-modal-close { 
    position: absolute; 
    top: 20px; right: 20px; 
    font-size: 40px; color: white; 
    background: none; border: none; 
    cursor: pointer; z-index: 310;
}

/* Calculadora */
.calc-body { display:flex; flex-direction:column; align-items:center; background:#222; }
#calc-display { width:300px; background:#333; color:white; font-size:30px; text-align:right; padding:10px; margin-bottom:10px; }
#calc-grid { display:grid; grid-template-columns:repeat(4, 1fr); gap:10px; width:300px; }
.calc-button { padding:15px; font-size:18px; cursor:pointer; background:#444; color:white; border:none; border-radius:5px; }

/* Recientes */
#app-recents { background:transparent !important; }
#app-recents .app-body { background:transparent; }
.recent-card { background:white; padding:15px; margin-bottom:10px; border-radius:10px; display:flex; justify-content:space-between; cursor:pointer; }